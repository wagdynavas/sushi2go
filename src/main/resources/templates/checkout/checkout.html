<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout</title>
    <link th:replace="/fragments/fragments :: bootstrap_css">
    <link th:replace="/fragments/fragments :: fragment_css">
    <link rel="stylesheet" type="text/css" href="/css/checkout.css">

    <script src="https://polyfill.io/v3/polyfill.min.js?version=3.52.1&features=fetch"></script>
    <script src="https://js.stripe.com/v3/"></script>

    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/solid.js" integrity="sha384-tzzSw1/Vo+0N5UhStP3bvwWPq+uvzCMfrN1fEFe+xBmv1C/AtVX5K0uZtmcHitFZ" crossorigin="anonymous"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/fontawesome.js" integrity="sha384-6OIrr52G08NpOFSZdxxz1xdNSndlD4vdcf/q2myIUVO0VsqaGHJsB0RaBE01VTOY" crossorigin="anonymous"></script>
</head>
<body>
<header th:replace="/fragments/fragments :: header"></header>

<div class="container-fluid checkout-container">
    <div class="wrapper">
        <div class="row">
            <div class="col-12 col-lg-7 checkout-right">
                    <nav class="nav">
                        <!--  <button id="btn-delivery" type="button" class="btn btn-dark btn-red delivery-type active ">
                              <i class="fas fa-car"></i>
                              <span>Delivery</span>
                          </button> -->

                        <button id="btn-pickup" type="button" class="btn btn-dark btn-red delivery-type">
                            <i class="fas fa-walking"></i>
                            <span>Pickup</span>
                        </button>
                    </nav>
                    <!--  <div id="delivery-wrapper">
                          <h2>Deliver Details</h2>
                          <div class="row">
                              <div class="form-group col-12 col-lg-9">
                                  <select th:field="*{restaurantBranch}" class="form-control form-control-lg" placeholder="">
                                      <option th:value="${null}">Select restaurant branch</option>
                                      <option th:value="${rbs.getValue()}" th:each="rbs : ${restaurantBranch}" th:text="${rbs.getLabel()}"></option>
                                  </select>
                              </div>

                              <div class="form-group col-12 col-lg-9">
                                  <input th:field="*{deliverAddress}" type="text" class="form-control form-control-lg" placeholder="Enter delivery address">
                              </div>

                              <div class="form-group col-12 col-lg-9">
                                  <input th:field="*{deliverAddressComplement}" type="text" class="form-control form-control-lg"
                                         placeholder="Apartment, suite, floor, etc..">
                              </div>

                              <div class="form-group col-12 col-lg-9">
                                  <textarea rows="2" th:field="*{deliverInstructions}" class="form-control form-control-lg"
                                            placeholder="Add deliver instructions"></textarea>
                              </div>
                          </div>
                      </div> -->

                    <div id="pickup-wrapper" class="">
                        <h2>Pickup Details</h2>
                        <div class="row">
                            <div class="form-group col-12 col-lg-9">
                                <select  id="pickup-selector" class="form-control form-control-lg" placeholder="">
                                    <option>Select restaurant branch</option>
                                    <option value="dundas">Dundas & Kipling (Dundas)</option>
                                    <option value="royal-york">Bloor & Royal York (Royal York)</option>
                                    <option value="queensway">Queensway & Islington (Queensway)</option>
                                </select>
                                <div class="row">
                                    <div id="queensway" class="col-12 address-container hidden">
                                        <h4>Queensway & Islington (Queensway)</h4>
                                        <p> Open Monday to Saturday<br> Tel 416-259-4246, 416-259-4665<br>
                                            Address: 892 The Queensway</p>
                                    </div>
                                    <div id="dundas" class="col-12  address-container hidden">
                                        <h4>Dundas & Kipling (Dundas)</h4>
                                        <p> Open Monday to Saturday <br> Tel 416-233-4227 <br>
                                            Address: 5280 Dundas St.West</p>
                                    </div>

                                    <div id="royal-york" class="col-12  address-container hidden">
                                        <h4>Bloor & Royal York (Royal York)</h4>
                                        <p> Open Tuesday to Sunday<br> 416-232-9030, 416-236-5909<br>
                                            Address: 2976 Bloor St.West</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="tips">
                        <p>Show you support with a tip:</p>
                        <a id="tip-10" class="btn btn-lg btn-light btn-tip" th:href="@{/change-tip/{value}(value=${10})}" >10%</a>
                        <a id="tip-15" class="btn btn-lg btn-light btn-tip" th:href="@{/change-tip/{value}(value=${15})}" >15%</a>
                        <a id="tip-20" class="btn btn-lg btn-light btn-tip" th:href="@{/change-tip/{value}(value=${20})}" >20%</a>
                        <a id="tip-25" class="btn btn-lg btn-light btn-tip" th:href="@{/change-tip/{value}(value=${25})}" >25%</a>
                        <a id="tip-30" class="btn btn-lg btn-light btn-tip" th:href="@{/change-tip/{value}(value=${30})}" >30%</a>
                        <a id="tip-0"class="btn btn-lg btn-light btn-tip" th:href="@{/change-tip/{value}(value=${0})}" >No Thanks</a>
                    </div>

                    <div class="form-group">
                        <input id="checkout-button" type="submit" class="btn btn-dark btn-red btn-lg form-control col-12 col-lg-9" value="Save & Continue"/>
                    </div>
            </div>


            <div class="col-12 col-lg-4">
                        <h2>Your Order</h2>
                        <div th:each="product : ${checkoutOrder.products}" class="row">
                            <div class="col-12">
                                <div class="row">
                                    <div th:text="${product.getQuantity()}" class="col-1"></div>
                                    <div th:text="${product.getProductName()}" class="col-6"></div>
                                    <div th:text="'$' + ${product.getPrice()}" class="col-3"></div>
                                    <a class="delete-btn" th:href="@{/checkout/delete/{id}(id=${product.getId()})}">
                                        <i class="fas fa-trash"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-12 col-lg-11 divisor"></div>
                        </div>
                        <div class="row">
                            <label class="col-7">Subtotal:</label>
                            <div class="col-3" th:text=" '$' + ${subTotal}"></div>
                        </div>
                        <div class="row">
                            <label class="col-7">Tip:</label>
                            <div class="col-3" th:text=" '$' + ${tip}"></div>
                        </div>

                        <div class="row">
                            <label class="col-7">Taxes:</label>
                            <div class="col-3" th:text=" '$' + ${tax}"></div>
                        </div>
                        <div class="row">
                            <label class="col-7"><strong>Total:</strong></label>
                            <div class="col-3 total-amount-value" th:text=" '$' +  ${totalAmount}"></div>
                        </div>
            </div>
        </div>
    </div>
   <!-- <form class="form-horizontal" method="POST" action="/charge" th:object="${checkoutOrder}"> -->

<!-- </form> -->

</div>
<div class="footer" th:replace="/fragments/fragments :: footer"></div>



<script th:replace="/fragments/fragments :: jquery"></script>
<script th:replace="/fragments/fragments :: bootstrap_js"></script>
<script  src="/js/checkout.js"></script>
<script th:inline="javascript">


    // Create an instance of the Stripe object with your publishable API key
    let stripe =Stripe('pk_test_51HgH1FGRXCYNFhPCNMunxSJwfwvQ0ByuLuVV66NokzN14olynK8s2uYOf8g7gExiahYFjKZM8jEQtecc76JBXSEh00n09awOLA');
    let checkoutButton = document.getElementById('checkout-button');

    checkoutButton.addEventListener('click', function() {
        // Create a new Checkout Session using the server-side endpoint you
        // created in step 3.
        fetch('/create-checkout-session', {
            method: 'POST',
        })
            .then(function(response) {
                return response.json();
            })
            .then(function(session) {
                console.log(session)
                return stripe.redirectToCheckout({ sessionId: session.id });
            })
            .then(function(result) {
                // If `redirectToCheckout` fails due to a browser or network
                // error, you should display the localized error message to your
                // customer using `error.message`.
                if (result.error) {
                    alert(result.error.message);
                }
            })
            .catch(function(error) {
                console.error('Error:', error);
            });
    });
</script>
<script th:inline="javascript">

    document.addEventListener("DOMContentLoaded", function(){
        let tipPercentage = /*[[${tipPercentage}]]*/ 'default';
        $("#tip-10").removeClass("active");
        $("#tip-15").removeClass("active");
        $("#tip-20").removeClass("active");
        $("#tip-25").removeClass("active");
        $("#tip-30").removeClass("active");
        $("#tip-0").removeClass("active");

        $("#tip-" + tipPercentage).addClass("active");
    });
</script>
</body>
</html>